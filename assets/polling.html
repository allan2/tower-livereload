<script type="module">
  const retry = (it) =>
    fetch(it)
      .then(() => console.log("[tower-livereload] reload..."))
      .then(() => window.location.reload())
      .catch(() => setTimeout(() => retry(it), 1000));
  let disconnected = () => {{
      console.log("[tower-livereload] disconnected...");
      retry("{back_up}");
  }};

  console.log("[tower-livereload] connected...");
  fetch("{long_poll}")
    .then((it) => it.text().finally(disconnected))
    .finally(disconnected)
    .catch(() => null);
</script>
